**プロジェクト：車両テレメトリ・制御統合基盤**<br><br>


<br>■概要<br>
本プロジェクトの目的は、車両の状態取得と制御を安全かつリアルタイムに実現するクラウド連携基盤を構築することです。
ユーザー操作から車両へのコマンド送信、車両からのテレメトリ収集までを一貫して扱えるアーキテクチャを設計・実装し、遠隔操作と状態管理を高信頼に行える仕組みを確立しました。
なお、アプリケーションはスマートフォンからの利用を前提としています。


<br>■アーキテクチャ<br>  
![Architecture](docs/architecture.svg)

<br>■技術スタック・選定理由<br>  
UI / 操作系  
- AWS Amplify（ユーザー操作の入口）<br>
  スマートフォンからの利用を前提としており、軽量で高速に配信できるホスティング環境が必要だったため採用。<br>
  将来的に大規模化する場合は、独自のホスティング環境（EC2 など）への移行も容易な構成としている。<br>
- Next.js（車両状態表示・コマンド送信 UI)<br>
  スマホ操作での即時性と視認性を重視し、SSR による高速表示と柔軟な UI 構築が可能。<br>
  
バックエンド / API
- FastAPI（車両制御 API）<br>
  車両制御では 低レイテンシ・高信頼性 が重要なため採用。<br>
  型定義ができる点で安全に実装できる。<br>
- EC2（制御ロジックの実行環境）<br>
  テレメトリの分析、車両制御ロジックを柔軟に実行するために採用。<br>
  スケーリングしやすい、アプリケーションとの責務分離を明確にするため、AWS Amplifyと分けて実装。<br>
  
データ管理
- DynamoDB（車両状態・コマンドの永続化）<br>
  車両テレメトリはスケールしやすく、書き込み頻度も高いため、スケーラブルで低レイテンシな DynamoDB を採用。<br>
- DynamoDB Streams（イベントトリガー）<br>
  車両へのコマンド送信を 確実に・順序通りに 処理するため、DynamoDB Streams を利用。<br>

車両通信
- AWS IoT Core（車両との MQTT 通信）<br>
  車両との双方向通信には 低遅延・軽量・信頼性 が求められるため、MQTT を採用。<br>
- MQTT（リアルタイム制御）<br>
  車両の状態更新やコマンド送信をリアルタイムに行うため、軽量プロトコルである MQTT を採用。<br>
  車両のような制約デバイスとの通信に最適。<br>
- AWS Lambda（DynamoDB Streams を受けて車両へターゲット値を送信）<br>
  コマンド登録 → 車両への MQTT Publish を自動化するために採用。<br>

検証環境
- 車両シミュレーター（ECU 動作の模擬）<br>
  実車 ECU がなくても動作検証できるように、車両の状態変化・コマンド反応を模擬するシミュレーターを作成。<br>
  本環境ではシミュレータをEC2に常駐、動作する。<br>


<br>■主要機能<br>
- テレメトリ収集<br>
車両シミュレータ（Python/EC2）から、走行速度・座標・状態等のデータを100ms周期でAWS IoT Coreへ送信。<br>
- 車両制御<br>
  Next.jsで構築した管理画面から、MQTTプロトコルを介して車両へコマンドを送信。<br>
  本プロジェクトでは、以下項目を操作可能<br>
  ・車両ドアロック、アンロック<br>
  ・エアコン設定温度<br>


<br>■工夫点<br>
- 車両の安全思想を反映した「状態遷移ロジック」の実装<br>
車両が完全に停止していることを 3 秒間連続で確認してから次の動作へ進む「静止判定ロジック」をシミュレーター側に実装。<br>
通信遅延や誤操作があっても、車両が安全な状態でのみ制御が進むようにし、実車開発で重視されるフェイルセーフ思想を反映した。<br>

- AWS IoT Coreを採用した「低遅延・双方向」の通信基盤<br>
  MQTT を採用し、車両からのテレメトリ（100ms周期）と、ブラウザからのコマンド送信を双方向で処理できる通信基盤を構築。<br>
  これにより、車両とクラウドが常に同期した状態で動作するコネクテッドカーの基本構造を実装レベルで再現した。<br>

- クラウド側での「生存監視（LWT）」による接続状態の可視化<br>
  車両側の通信断をクラウド（IoT Core）が即時に検知し、UI に「オフライン」と表示する仕組みを導入。<br>
  MQTT の LWT（Last Will and Testament）概念を取り入れ、通信断後に古い車両ステータスを表示し続けないように設計し、ユーザーに対して常に正確で信頼できる状態表示を実現した。<br>


<br>■課題(今後の改善点)<br>
- アプリケーションからのデータフェッチのwebsocket化 <br> 
  現在は1秒ごとにhttpリクエストを送っているが、リアルタイム応答、コストカットの点から変更すべき。<br>
- コマンド結果のフィードバック機構の不足<br>
  現状では、ユーザーが UI からコマンドを送信しても、車両側での処理結果（成功・失敗）が UI に返らない。<br>
  今後は、車両側で処理結果を MQTT Publish し、UI 側で受信・表示することで、双方向の状態同期を実現する。<br>
- 認証・認可の強化（Cognito / IAM の導入）<br>
  現在は最小構成のため、ユーザー認証、車両ごとのアクセス権管理などがない状態。セキュリティの面からは必須。<br>
- テレメトリの蓄積・分析基盤の拡張<br>
  現在は DynamoDB でリアルタイム処理を中心に構築しているが、将来的にはKinesis、S3、Athenaなどを組み合わせることで、車両ログの長期保存・分析が可能になる。<br>
- UIレスポンシブ対応<br>
